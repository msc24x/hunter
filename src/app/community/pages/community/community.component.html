<app-bar></app-bar>
<app-loading *ngIf="loading"></app-loading>

<div *ngIf="!community && loading" class="large-app-page">
    <spinner></spinner>
</div>

<div *ngIf="community" class="full-app-page">
    <div class="community-details">
        <div class="logo">
            <img
                src="/api/media/{{ community.logo_file_path }}"
                alt="{{ community.name }} community logo"
            />
        </div>
        <h2>{{ community.name }}</h2>
        <p>{{ community.description }}</p>
        <p>
            <a href="" (click)="openUrl(community.website_link)">{{
                community.website_link
            }}</a>
        </p>

        <h3>
            {{ community._count.members }} Member{{
                community._count.members !== 1 ? "s" : ""
            }}
            &nbsp; &bull; &nbsp;
            {{ community._count.competitions }} Competition{{
                community._count.competitions !== 1 ? "s" : ""
            }}
        </h3>
        <p>
            Created {{ community.created_at | timeAgo }}&nbsp; &bull; &nbsp;By
            <user-display [userInfo]="community.admin_user"></user-display>
        </p>

        <div
            class="button main disabled"
            *ngIf="community.admin_user_id === user?.id"
        >
            You're the Admin
        </div>

        <ng-template #communityButtons>
            <div
                class="button main"
                [ngClass]="{ disabled: loading }"
                *ngIf="!isApprovedMember() && !requestSent()"
                (click)="sendJoinRequest()"
            >
                Join Community
            </div>
            <div
                class="button main danger"
                *ngIf="isApprovedMember()"
                [ngClass]="{ disabled: loading }"
            >
                Leave Community
            </div>
            <div class="button main danger disabled" *ngIf="requestSent()">
                Request Sent
            </div>
        </ng-template>

        <ng-outlet
            [ngTemplateOutlet]="communityButtons"
            *ngIf="community.admin_user_id !== user?.id"
        ></ng-outlet>

        <div *ngIf="pendingRequests.length" class="membership-requests">
            <h2>Membership Requests</h2>

            <div class="request" *ngFor="let req of pendingRequests">
                <div class="user-info">
                    <user-display [userInfo]="req.user"></user-display> Wants to
                    join
                </div>
                <p class="time">Received {{ req.created_at | timeAgo }}</p>
                <div class="actions">
                    <div class="button main accept">Accept</div>
                    <div class="button main danger reject">Reject</div>
                </div>
            </div>
        </div>
    </div>

    <div class="panel">
        <competitions-list
            [community_id]="community.id"
            route="compete/p"
        ></competitions-list>
    </div>
</div>
